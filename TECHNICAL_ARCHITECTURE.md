# MangoNote æŠ€æœ¯æ¶æ„æ–‡æ¡£

## ç³»ç»Ÿæ•´ä½“æ¶æ„

### æ¶æ„æ¦‚è§ˆ
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      å‰ç«¯å±‚ (Frontend)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Next.js 14 + React 18 + TypeScript                       â”‚
â”‚  â€¢ ç”¨æˆ·ç•Œé¢ç»„ä»¶ (UI Components)                               â”‚
â”‚  â€¢ é¡µé¢è·¯ç”± (App Router)                                     â”‚
â”‚  â€¢ çŠ¶æ€ç®¡ç† (Client State)                                   â”‚
â”‚  â€¢ æ¨¡æ€æ¡†ç³»ç»Ÿ (Modal System)                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                        HTTP/API è°ƒç”¨
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      API å±‚ (Backend API)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Next.js API Routes                                        â”‚
â”‚  â€¢ PDF å¤„ç†ç«¯ç‚¹ (/api/pdf/upload)                            â”‚
â”‚  â€¢ éŸ³é¢‘å¤„ç†ç«¯ç‚¹ (/api/audio/*)                              â”‚
â”‚  â€¢ YouTube å¤„ç†ç«¯ç‚¹ (/api/youtube/*)                        â”‚
â”‚  â€¢ ç¬”è®°ç®¡ç†ç«¯ç‚¹ (/api/notes/*)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                         æ•°æ®åº“æŸ¥è¯¢ & AI è°ƒç”¨
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   æœåŠ¡å±‚ (Service Layer)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ AI å†…å®¹åˆ†ææœåŠ¡ (AIService)                               â”‚
â”‚  â€¢ PDF æ–‡æœ¬æå–æœåŠ¡ (pdf-parse)                              â”‚
â”‚  â€¢ æ•°æ®åº“è¿æ¥æœåŠ¡ (PostgreSQL)                               â”‚
â”‚  â€¢ æ–‡ä»¶å­˜å‚¨æœåŠ¡ (File Storage)                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                          æ•°æ®æŒä¹…åŒ–
                              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     æ•°æ®å±‚ (Data Layer)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  PostgreSQL æ•°æ®åº“                                          â”‚
â”‚  â€¢ users (ç”¨æˆ·è¡¨)                                           â”‚
â”‚  â€¢ notes (ç¬”è®°è¡¨)                                           â”‚
â”‚  â€¢ content_blocks (å†…å®¹å—è¡¨)                                â”‚
â”‚  â€¢ flashcards (é—ªå¡è¡¨)                                      â”‚
â”‚  â€¢ folders (æ–‡ä»¶å¤¹è¡¨)                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## å‰ç«¯æ¶æ„è¯¦è§£

### 1. é¡µé¢è·¯ç”±ç»“æ„
```
src/app/
â”œâ”€â”€ layout.tsx                  # æ ¹å¸ƒå±€ç»„ä»¶
â”œâ”€â”€ page.tsx                    # ç€é™†é¡µ
â”œâ”€â”€ globals.css                 # å…¨å±€æ ·å¼
â”œâ”€â”€ dashboard/
â”‚   â””â”€â”€ page.tsx               # ä»ªè¡¨æ¿é¡µé¢
â”œâ”€â”€ notes/
â”‚   â””â”€â”€ [id]/
â”‚       â””â”€â”€ page.tsx           # åŠ¨æ€ç¬”è®°è¯¦æƒ…é¡µ
â”œâ”€â”€ auth/
â”‚   â”œâ”€â”€ signin/
â”‚   â”‚   â””â”€â”€ page.tsx           # ç™»å½•é¡µé¢
â”‚   â””â”€â”€ signup/
â”‚       â””â”€â”€ page.tsx           # æ³¨å†Œé¡µé¢
â”œâ”€â”€ processing/
â”‚   â””â”€â”€ page.tsx               # å¤„ç†çŠ¶æ€é¡µé¢
â””â”€â”€ api/                       # API è·¯ç”±
    â”œâ”€â”€ pdf/
    â”‚   â””â”€â”€ upload/
    â”‚       â””â”€â”€ route.ts       # PDF ä¸Šä¼ å¤„ç†
    â””â”€â”€ auth/
        â””â”€â”€ [...nextauth]/
            â””â”€â”€ route.ts       # è®¤è¯å¤„ç† (è®¡åˆ’ä¸­)
```

### 2. ç»„ä»¶æ¶æ„
```
src/components/
â”œâ”€â”€ Sidebar.tsx                # ä¾§è¾¹æ å¯¼èˆªç»„ä»¶
â”œâ”€â”€ modals/                    # æ¨¡æ€æ¡†ç»„ä»¶é›†åˆ
â”‚   â”œâ”€â”€ RecordAudioModal.tsx   # å½•éŸ³æ¨¡æ€æ¡†
â”‚   â”œâ”€â”€ UploadAudioModal.tsx   # éŸ³é¢‘ä¸Šä¼ æ¨¡æ€æ¡†
â”‚   â”œâ”€â”€ UploadPDFModal.tsx     # PDF ä¸Šä¼ æ¨¡æ€æ¡†
â”‚   â””â”€â”€ YoutubeVideoModal.tsx  # YouTube è§†é¢‘æ¨¡æ€æ¡†
â”œâ”€â”€ ui/                        # åŸºç¡€ UI ç»„ä»¶ (è®¡åˆ’æ‰©å±•)
â”‚   â”œâ”€â”€ Button.tsx
â”‚   â”œâ”€â”€ Input.tsx
â”‚   â”œâ”€â”€ Modal.tsx
â”‚   â””â”€â”€ Card.tsx
â””â”€â”€ features/                  # åŠŸèƒ½ç‰¹å®šç»„ä»¶ (è®¡åˆ’æ‰©å±•)
    â”œâ”€â”€ notes/
    â”œâ”€â”€ flashcards/
    â””â”€â”€ dashboard/
```

### 3. çŠ¶æ€ç®¡ç†ç­–ç•¥
```typescript
// å½“å‰: React å†…ç½®çŠ¶æ€ç®¡ç†
const [activeModal, setActiveModal] = useState<string | null>(null)
const [selectedFile, setSelectedFile] = useState<File | null>(null)
const [isUploading, setIsUploading] = useState(false)

// æœªæ¥æ‰©å±•: Context API æˆ–çŠ¶æ€ç®¡ç†åº“
interface AppState {
  user: User | null
  notes: Note[]
  currentNote: Note | null
  uiState: {
    activeModal: string | null
    isLoading: boolean
  }
}
```

## åç«¯ API æ¶æ„

### 1. API ç«¯ç‚¹è®¾è®¡

#### PDF å¤„ç† API
```typescript
// /api/pdf/upload/route.ts
export async function POST(request: NextRequest) {
  // 1. è¯·æ±‚éªŒè¯å’Œæ–‡ä»¶æå–
  const formData = await request.formData()
  const file = formData.get('pdf') as File
  
  // 2. æ–‡ä»¶éªŒè¯
  if (!file || file.type !== 'application/pdf') {
    return NextResponse.json({ error: '...' }, { status: 400 })
  }
  
  // 3. PDF æ–‡æœ¬æå–
  const buffer = Buffer.from(await file.arrayBuffer())
  const pdfData = await pdfParse(buffer)
  
  // 4. AI å†…å®¹åˆ†æ
  const aiService = new AIService()
  const analysisResult = await aiService.analyzeContent(pdfData.text)
  
  // 5. æ•°æ®åº“å­˜å‚¨
  const noteId = uuidv4()
  await query(`INSERT INTO notes ...`, [...])
  
  // 6. å“åº”è¿”å›
  return NextResponse.json({ success: true, data: { note, ... } })
}
```

#### éŸ³é¢‘å¤„ç† API (è§„åˆ’ä¸­)
```typescript
// /api/audio/upload/route.ts
export async function POST(request: NextRequest) {
  // 1. éŸ³é¢‘æ–‡ä»¶æ¥æ”¶å’ŒéªŒè¯
  // 2. è¯­éŸ³è½¬æ–‡å­— (Whisper API)
  // 3. AI å†…å®¹åˆ†æ
  // 4. æ•°æ®åº“å­˜å‚¨
  // 5. å“åº”è¿”å›
}

// /api/audio/transcribe/route.ts  
export async function POST(request: NextRequest) {
  // å®æ—¶è½¬å½•æ¥å£
}
```

#### YouTube å¤„ç† API (è§„åˆ’ä¸­)
```typescript
// /api/youtube/process/route.ts
export async function POST(request: NextRequest) {
  // 1. YouTube URL éªŒè¯
  // 2. è§†é¢‘ä¿¡æ¯è·å–
  // 3. å­—å¹•æå– (youtube-dl æˆ– YouTube API)
  // 4. AI å†…å®¹åˆ†æ
  // 5. æ•°æ®åº“å­˜å‚¨
}
```

### 2. æ•°æ®æµå¤„ç†

#### PDF å¤„ç†æµæ°´çº¿
```mermaid
graph LR
    A[æ–‡ä»¶ä¸Šä¼ ] --> B[æ–‡ä»¶éªŒè¯]
    B --> C[ç¼“å†²åŒºåˆ›å»º]
    C --> D[PDF è§£æ]
    D --> E[æ–‡æœ¬æå–]
    E --> F[AI åˆ†æ]
    F --> G[å†…å®¹ç»“æ„åŒ–]
    G --> H[æ•°æ®åº“å­˜å‚¨]
    H --> I[å“åº”è¿”å›]
    
    F --> F1[æ ‡é¢˜ç”Ÿæˆ]
    F --> F2[æ‘˜è¦ç”Ÿæˆ]
    F --> F3[è¦ç‚¹æå–]
    F --> F4[é—®é¢˜ç”Ÿæˆ]
    F --> F5[é—ªå¡åˆ›å»º]
```

#### é”™è¯¯å¤„ç†æœºåˆ¶
```typescript
try {
  // æ ¸å¿ƒå¤„ç†é€»è¾‘
} catch (error) {
  console.error('Processing error:', error)
  
  // åˆ†ç±»é”™è¯¯å¤„ç†
  if (error instanceof PDFError) {
    return NextResponse.json({ error: 'PDF parsing failed' }, { status: 400 })
  } else if (error instanceof DatabaseError) {
    return NextResponse.json({ error: 'Database error' }, { status: 500 })
  } else {
    return NextResponse.json({ error: 'Internal server error' }, { status: 500 })
  }
}
```

## æ•°æ®åº“æ¶æ„è®¾è®¡

### 1. æ•°æ®æ¨¡å‹å…³ç³»å›¾
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   users     â”‚     â”‚   folders    â”‚     â”‚   notes         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)     â”‚â”€â”€â”€â”€â–¶â”‚ user_id (FK) â”‚     â”‚ id (PK)         â”‚
â”‚ email       â”‚     â”‚ name         â”‚     â”‚ user_id (FK)    â”‚
â”‚ full_name   â”‚     â”‚ color        â”‚     â”‚ folder_id (FK)  â”‚
â”‚ avatar_url  â”‚     â”‚ icon         â”‚     â”‚ title           â”‚
â”‚ created_at  â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚ source_type     â”‚
â”‚ is_guest    â”‚                          â”‚ content_status  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚ transcription   â”‚
                    â”‚ flashcards   â”‚     â”‚ created_at      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ content_blocks  â”‚ â”‚ id (PK)      â”‚              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ note_id (FK) â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ id (PK)         â”‚ â”‚ user_id (FK) â”‚
â”‚ note_id (FK)    â”‚â”€â”‚ question     â”‚
â”‚ type            â”‚ â”‚ answer       â”‚
â”‚ icon            â”‚ â”‚ created_at   â”‚
â”‚ icon_color      â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ title           â”‚
â”‚ content (JSON)  â”‚
â”‚ sort_order      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. è¡¨ç»“æ„è¯¦ç»†å®šä¹‰

#### ç”¨æˆ·è¡¨ (users)
```sql
CREATE TABLE users (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    email VARCHAR(255) UNIQUE NOT NULL,
    full_name VARCHAR(255),
    avatar_url TEXT,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW(),
    is_guest BOOLEAN DEFAULT FALSE,
    last_active_at TIMESTAMP DEFAULT NOW()
);
```

#### ç¬”è®°è¡¨ (notes)
```sql
CREATE TABLE notes (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES users(id) ON DELETE CASCADE,
    folder_id UUID REFERENCES folders(id) ON DELETE SET NULL,
    title VARCHAR(500) NOT NULL,
    source_type VARCHAR(50) NOT NULL, -- 'import', 'record', 'youtube', 'manual'
    content_status VARCHAR(50) DEFAULT 'processing', -- 'processing', 'completed', 'failed'
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW(),
    url TEXT, -- åŸå§‹ URL (YouTube ç­‰)
    transcription TEXT, -- å®Œæ•´è½¬å½•æ–‡æœ¬
    image_url TEXT, -- å°é¢å›¾ç‰‡
    markdown TEXT -- Markdown æ ¼å¼å†…å®¹
);
```

#### å†…å®¹å—è¡¨ (content_blocks)
```sql
CREATE TABLE content_blocks (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    note_id UUID REFERENCES notes(id) ON DELETE CASCADE,
    type VARCHAR(50) NOT NULL, -- 'summary', 'key_points', 'questions', 'mindmap'
    icon VARCHAR(10),
    icon_color VARCHAR(20),
    title VARCHAR(255) NOT NULL,
    content JSONB NOT NULL, -- çµæ´»çš„å†…å®¹å­˜å‚¨
    sort_order INTEGER DEFAULT 0
);
```

#### é—ªå¡è¡¨ (flashcards)
```sql
CREATE TABLE flashcards (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    note_id UUID REFERENCES notes(id) ON DELETE CASCADE,
    user_id UUID REFERENCES users(id) ON DELETE CASCADE,
    question TEXT NOT NULL,
    answer TEXT NOT NULL,
    created_at TIMESTAMP DEFAULT NOW()
);
```

### 3. æ•°æ®åº“è¿æ¥å’Œæ“ä½œ

#### è¿æ¥æ± é…ç½®
```typescript
// src/lib/database.ts
import { Pool } from 'pg'

const pool = new Pool({
  connectionString: process.env.DATABASE_URL,
  ssl: process.env.NODE_ENV === 'production' ? { rejectUnauthorized: false } : false,
  max: 20, // æœ€å¤§è¿æ¥æ•°
  idleTimeoutMillis: 30000, // ç©ºé—²è¶…æ—¶
  connectionTimeoutMillis: 2000, // è¿æ¥è¶…æ—¶
})

export async function query(text: string, params?: any[]) {
  const client = await pool.connect()
  try {
    const result = await client.query(text, params)
    return result
  } finally {
    client.release()
  }
}
```

#### æŸ¥è¯¢ä¼˜åŒ–ç­–ç•¥
```sql
-- ç´¢å¼•ä¼˜åŒ–
CREATE INDEX idx_notes_user_id ON notes(user_id);
CREATE INDEX idx_notes_created_at ON notes(created_at DESC);
CREATE INDEX idx_content_blocks_note_id ON content_blocks(note_id);
CREATE INDEX idx_flashcards_note_id ON flashcards(note_id);
CREATE INDEX idx_flashcards_user_id ON flashcards(user_id);

-- å¤åˆç´¢å¼•
CREATE INDEX idx_notes_user_status ON notes(user_id, content_status);
CREATE INDEX idx_content_blocks_note_sort ON content_blocks(note_id, sort_order);
```

## AI æœåŠ¡æ¶æ„

### 1. AI æœåŠ¡æ¥å£è®¾è®¡
```typescript
// src/lib/ai-service.ts
export interface AIService {
  analyzeContent(text: string): Promise<AnalysisItem[]>
  generateFlashcards(text: string): Promise<Flashcard[]>
  generateMindMap(text: string): Promise<MindMapData>
  generateQuiz(text: string): Promise<Question[]>
  summarizeContent(text: string, options?: SummaryOptions): Promise<string>
}
```

### 2. å½“å‰å®ç° (Mock æœåŠ¡)
```typescript
export class AIService implements AIServiceInterface {
  async analyzeContent(text: string): Promise<AnalysisItem[]> {
    // æ¨¡æ‹Ÿ AI åˆ†æé€»è¾‘
    return [
      {
        type: 'title',
        title: 'Document Title',
        content: { title: this.extractTitle(text) }
      },
      {
        type: 'summary',
        title: 'Summary', 
        content: { text: this.generateSummary(text) },
        icon: 'ğŸ“„',
        icon_color: '#3B82F6'
      },
      // ... å…¶ä»–å†…å®¹å—
    ]
  }
  
  private extractTitle(text: string): string {
    // ç®€å•æ ‡é¢˜æå–é€»è¾‘
    const firstLine = text.split('\n')[0].trim()
    return firstLine.length > 0 && firstLine.length < 100 
      ? firstLine 
      : text.substring(0, 50).trim() + '...'
  }
}
```

### 3. æœªæ¥é›†æˆè®¡åˆ’
```typescript
// OpenAI é›†æˆ
export class OpenAIService implements AIServiceInterface {
  private openai: OpenAI
  
  constructor() {
    this.openai = new OpenAI({
      apiKey: process.env.OPENAI_API_KEY
    })
  }
  
  async analyzeContent(text: string): Promise<AnalysisItem[]> {
    const response = await this.openai.chat.completions.create({
      model: "gpt-4",
      messages: [
        {
          role: "system",
          content: "You are an AI assistant that analyzes text content..."
        },
        {
          role: "user", 
          content: text
        }
      ],
      functions: [...] // ç»“æ„åŒ–è¾“å‡ºå®šä¹‰
    })
    
    return this.parseResponse(response)
  }
}
```

## æ€§èƒ½å’Œæ‰©å±•æ€§

### 1. æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

#### å‰ç«¯ä¼˜åŒ–
```typescript
// ä»£ç åˆ†å‰²å’Œæ‡’åŠ è½½
const UploadPDFModal = lazy(() => import('@/components/modals/UploadPDFModal'))
const YoutubeVideoModal = lazy(() => import('@/components/modals/YoutubeVideoModal'))

// å›¾ç‰‡ä¼˜åŒ–
import Image from 'next/image'

// ç¼“å­˜ç­–ç•¥
export const metadata = {
  title: 'MangoNote',
  description: '...',
  openGraph: { ... }
}
```

#### åç«¯ä¼˜åŒ–
```typescript
// API å“åº”ç¼“å­˜
export async function GET() {
  return NextResponse.json(data, {
    headers: {
      'Cache-Control': 'public, max-age=3600, stale-while-revalidate=86400'
    }
  })
}

// æµå¼æ–‡ä»¶å¤„ç†
export async function POST(request: NextRequest) {
  const stream = request.body
  // æµå¼å¤„ç†å¤§æ–‡ä»¶ï¼Œé¿å…å†…å­˜æº¢å‡º
}
```

### 2. å¯æ‰©å±•æ€§è®¾è®¡

#### å¾®æœåŠ¡æ¶æ„ (æœªæ¥è§„åˆ’)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Web App   â”‚    â”‚  Auth API   â”‚    â”‚  File API   â”‚
â”‚  (Next.js)  â”‚â”€â”€â”€â–¶â”‚  (Node.js)  â”‚    â”‚  (Node.js)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   AI API    â”‚    â”‚  Notes API  â”‚    â”‚ Storage API â”‚
â”‚  (Python)   â”‚    â”‚  (Node.js)  â”‚    â”‚  (Cloud)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æ•°æ®åº“åˆ†ç‰‡ç­–ç•¥
```sql
-- ç”¨æˆ·åˆ†ç‰‡
CREATE TABLE users_shard_1 AS SELECT * FROM users WHERE id % 4 = 0;
CREATE TABLE users_shard_2 AS SELECT * FROM users WHERE id % 4 = 1;
-- ...

-- æ—¶é—´åˆ†ç‰‡  
CREATE TABLE notes_2024_q1 AS SELECT * FROM notes WHERE created_at >= '2024-01-01' AND created_at < '2024-04-01';
-- ...
```

## å®‰å…¨æ¶æ„

### 1. æ•°æ®å®‰å…¨
```typescript
// è¾“å…¥éªŒè¯å’Œæ¸…ç†
const validatePDFFile = (file: File): boolean => {
  return file.type === 'application/pdf' && 
         file.size <= 10 * 1024 * 1024 && 
         file.name.length <= 255
}

// SQL æ³¨å…¥é˜²æŠ¤
const result = await query(
  'SELECT * FROM notes WHERE user_id = $1 AND id = $2',
  [userId, noteId]
)
```

### 2. è®¤è¯å’Œæˆæƒ (è®¡åˆ’ä¸­)
```typescript
// JWT ä»¤ç‰ŒéªŒè¯
export async function verifyToken(token: string): Promise<User | null> {
  try {
    const payload = jwt.verify(token, process.env.JWT_SECRET!)
    return payload as User
  } catch (error) {
    return null
  }
}

// æƒé™ä¸­é—´ä»¶
export function requireAuth(handler: NextApiHandler): NextApiHandler {
  return async (req, res) => {
    const token = req.headers.authorization?.replace('Bearer ', '')
    const user = await verifyToken(token || '')
    
    if (!user) {
      return res.status(401).json({ error: 'Unauthorized' })
    }
    
    req.user = user
    return handler(req, res)
  }
}
```

## ç›‘æ§å’Œæ—¥å¿—

### 1. åº”ç”¨ç›‘æ§
```typescript
// æ€§èƒ½ç›‘æ§
console.time('pdf-processing')
await processPDF(file)
console.timeEnd('pdf-processing')

// é”™è¯¯è¿½è¸ª
try {
  // ä¸šåŠ¡é€»è¾‘
} catch (error) {
  console.error('Error details:', {
    error: error.message,
    stack: error.stack,
    timestamp: new Date().toISOString(),
    userId: req.user?.id,
    fileInfo: { name: file.name, size: file.size }
  })
}
```

### 2. ä¸šåŠ¡æŒ‡æ ‡
```typescript
// ç”¨æˆ·è¡Œä¸ºè¿½è¸ª
const trackEvent = (event: string, properties: any) => {
  console.log('Analytics:', {
    event,
    properties,
    timestamp: new Date().toISOString()
  })
}

// ä½¿ç”¨ç¤ºä¾‹
trackEvent('pdf_upload_started', { fileSize: file.size })
trackEvent('note_created', { noteId, processingTime })
```

---

æœ¬æŠ€æœ¯æ¶æ„æ–‡æ¡£è¯¦ç»†æè¿°äº† MangoNote é¡¹ç›®çš„æŠ€æœ¯å®ç°æ–¹æ¡ˆï¼Œä¸ºå¼€å‘å›¢é˜Ÿæä¾›äº†æ¸…æ™°çš„æ¶æ„æŒ‡å¯¼å’Œå®ç°å‚è€ƒã€‚